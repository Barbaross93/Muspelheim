#!/bin/sh

#trap 'kill -9 -$$ %1 %2' EXIT INT

### Pre-lock
# Clear gpg-cache and ssh keys prior to lock. pam-gnupg starts it up again after unlock
gpg-connect-agent --no-autostart reloadagent /bye

# Clear all clipboard & selections
#xclip -selection clipboard /dev/null
#xclip -selection primary /dev/null
#xclip -selection secondary /dev/null
xsel -cb

xlock() {
	XSECURELOCK_AUTH_BACKGROUND_COLOR="#1c1c1c" XSECURELOCK_AUTH_FOREGROUND_COLOR="#dfdfaf" \
		XSECURELOCK_AUTH_WARNING_COLOR="#af5f5f" XSECURELOCK_SAVER="/home/barbarossa/.local/bin/background.sh" \
		XSECURELOCK_SHOW_HOSTNAME=0 XSECURELOCK_COMPOSITE_OBSCURER=0 XSECURELOCK_BURNIN_MITIGATION=0 XSECURELOCK_SHOW_USERNAME=0 \
		XSECURELOCK_PASSWORD_PROMPT=cursor XSECURELOCK_SHOW_DATETIME=0 XSECURELOCK_FONT="-misc-termsynu-medium-r-normal-*-14-*-*-*-*-*-iso10646-*" \
		XSECURELOCK_DATETIME_FORMAT="%A, %B %d$(DaySuffix) at %I:%M %p" XSECURELOCK_NO_COMPOSITE=1 xsecurelock -- xdotool key 0
}

#sunpape
pkill -STOP xnotify
status=$(playerctl status)
playerctl pause

# Need to restart xcompmgr w/ slock otherwise message gets wiped
pkill xcompmgr

## If using locker w/o screen coverage (e.g. xtrlock, slock with unlockscreen patch)
#sxiv -bf ~/.cache/i3lock/$currentWall &
#unclutter -idle 0 -jitter 99999 & # hide cursor

### Locker(s)
#slock -m "$(lock_msg.sh)" || lock
slock -m "$(lock_msg.sh)" || lock
#physlock -m -b "center_cursor" -a "setterm --blank 0 &>/dev/null; setterm --powerdown 0 &>/dev/null" || lock
#physlock -d -p $'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n' || lock
#i3lock -i ~/.cache/i3lock/$currentWall -e -t -u -n || lock

setsid -f xcompmgr &

### Post Lock
if [ "$status" = "Playing" ]; then
	playerctl play
fi
pkill -CONT xnotify

#wait
