#!/bin/sh

#trap 'kill -9 -$$ %1 %2' EXIT INT

### Pre-lock
# Clear gpg-cache and ssh keys prior to lock. pam-gnupg starts it up again after unlock
gpg-connect-agent --no-autostart reloadagent /bye

# Clear all clipboard & selections
#xclip -selection clipboard /dev/null
#xclip -selection primary /dev/null
#xclip -selection secondary /dev/null
xsel -cb

xlock() {
	XSECURELOCK_AUTH_BACKGROUND_COLOR="#1c1c1c" XSECURELOCK_AUTH_FOREGROUND_COLOR="#dfdfaf" \
		XSECURELOCK_AUTH_WARNING_COLOR="#af5f5f" XSECURELOCK_SAVER="/home/barbaross/.local/bin/background.sh" \
		XSECURELOCK_SHOW_HOSTNAME=1 XSECURELOCK_COMPOSITE_OBSCURER=1 XSECURELOCK_BURNIN_MITIGATION=0 XSECURELOCK_SHOW_USERNAME=0 \
		XSECURELOCK_PASSWORD_PROMPT=cursor XSECURELOCK_SHOW_DATETIME=0 XSECURELOCK_FONT="-barbaross-creeper-medium-r-normal--13-101-100-100-c-70-iso8859-1" \
		XSECURELOCK_NO_COMPOSITE=1 xsecurelock -- xdotool key 0
}

#sunpape
#pkill -STOP xnotify
#dunstctl set-paused true
echo pause >>/tmp/signal_bar
status=$(playerctl status)
playerctl pause
pkill xcompmgr

## If using locker w/o screen coverage (e.g. xtrlock, slock with unlockscreen patch)
#sxiv -bf ~/.cache/i3lock/$currentWall &
#unclutter -idle 0 -jitter 99999 & # hide cursor

### Locker(s)
#slock -m "$(lock_msg.sh)" || lock
#physlock -m -s -b "lock_msg.sh" -a "setterm --blank 0 &>/dev/null; setterm --powerdown 0 &>/dev/null" || lock
#physlock -m -s -p "$(lock_msg.sh)" || lock
slock || lock
#xlock || lock
#i3lock -i ~/.cache/i3lock/$currentWall -e -t -u -n || lock

### Post Lock
if [ "$status" = "Playing" ]; then
	playerctl play
fi
echo resume >>/tmp/signal_bar
#dunstctl set-paused false
#pkill -CONT xnotify
xcompmgr &

#wait
