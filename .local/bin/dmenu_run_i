#!/usr/bin/bash
# dmenu_run improved
# if a command ends with "!", it is started in term.

hc() {
	herbstclient "$@"
}
termcmd="$HOME/.local/bin/urxvtdc"

list_cmds() {
	IFS=: read -ra path <<<"$PATH"
	for dir in "${path[@]}"; do
		printf '%s\n' "$dir/"* |
			awk -F / '{print $NF;}'
	done | sort -u
}

launch() {
	cmd="$(list_cmds | dmenu $@)"
	[ -z "$cmd" ] && exit 1
	case $cmd in
	*\!) setsid -f ${termcmd} -e "$(printf "%s" "${cmd}" | cut -d'!' -f1)" ;;
	*) setsid -f ${cmd} ;;
	esac
}

launch2() {
	cmd="$(list_cmds | dmenu $@)"
	[ -z "$cmd" ] && exit 1
	case $cmd in
	*\!) hc split auto && hc cycle_frame && setsid -f ${termcmd} -e "$(printf "%s" "${cmd}" | cut -d'!' -f1)" ;;
	*) hc split auto && hc cycle_frame && setsid -f ${cmd} ;;
	esac
}

#launch "$@"

if hc compare tags.focus.frame_count = 1 && hc compare tags.focus.curframe_wcount = 0; then
	#launch "$@"
	rofi -show run
elif hc compare tags.focus.curframe_wcount = 0; then
	rofi -show run
	#launch "$@"
else
	rofi -show run -run-command "herbstclient and , split auto , cycle_frame , spawn {cmd}" -run-shell-command "herbstclient and , split auto , cycle_frame , spawn {terminal} -e {cmd}"
	#launch2 "$@"
fi
